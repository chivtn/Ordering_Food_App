{% extends "layout/base.html" %}
{% block title %}Quản lý đánh giá{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3>Đánh giá khách hàng</h3>
    <div>
      <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('owner.owner_reviews', only_unanswered=('0' if only_unanswered else '1')) }}">
        {{ 'Hiện tất cả' if only_unanswered else 'Chỉ chưa phản hồi' }}
      </a>
    </div>
  </div>

  {% if reviews %}
  <div class="list-group">
    {% for r in reviews %}
    <a class="list-group-item list-group-item-action" href="{{ url_for('owner.owner_review_detail', review_id=r.id) }}">
      <div class="d-flex justify-content-between">
        <div>
          <strong>{{ r.customer_name }}</strong> – Đơn #{{ r.order_id }}
          <div class="small text-muted">{{ r.created_at }}</div>
        </div>
        <div>
          {% for i in range(1,6) %}
            {% if i <= r.rating %}<i class="fas fa-star text-warning"></i>{% else %}<i class="far fa-star text-warning"></i>{% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="mt-2">
        <span class="text-muted">“{{ r.comment|truncate(120) }}”</span>
      </div>
      <div class="mt-2">
        {% if r.response_text %}
          <span class="badge bg-success">Đã phản hồi</span>
        {% else %}
          <span class="badge bg-warning text-dark">Chưa phản hồi</span>
        {% endif %}
      </div>
    </a>
    {% endfor %}
  </div>

  {% if pagination.pages > 1 %}
  <nav class="mt-3">
    <ul class="pagination pagination-sm">
      <li class="page-item {% if not pagination.has_prev %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('owner.owner_reviews', page=pagination.prev_num, only_unanswered=('1' if only_unanswered else '0')) }}">«</a>
      </li>
      {% for p in pagination.iter_pages(left_edge=1, right_edge=1, left_current=2, right_current=2) %}
        {% if p %}
          <li class="page-item {% if p == pagination.page %}active{% endif %}">
            <a class="page-link" href="{{ url_for('owner.owner_reviews', page=p, only_unanswered=('1' if only_unanswered else '0')) }}">{{ p }}</a>
          </li>
        {% else %}
          <li class="page-item disabled"><span class="page-link">…</span></li>
        {% endif %}
      {% endfor %}
      <li class="page-item {% if not pagination.has_next %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('owner.owner_reviews', page=pagination.next_num, only_unanswered=('1' if only_unanswered else '0')) }}">»</a>
      </li>
    </ul>
  </nav>
  {% endif %}

  {% else %}
  <div class="alert alert-secondary">Chưa có đánh giá mới nào.</div>
  {% endif %}
</div>
{% endblock %}
